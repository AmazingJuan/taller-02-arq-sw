# -------------------------------------------------
# Imagen base con Node.js
# -------------------------------------------------
FROM node:22-alpine

# -------------------------------------------------
# Variables de entorno
# -------------------------------------------------
ARG PORT=3000
ENV PORT=${PORT}
ENV NODE_ENV=production

# -------------------------------------------------
# Crear directorio de la app
# -------------------------------------------------
WORKDIR /usr/src/app

# -------------------------------------------------
# Copiar package.json y package-lock.json
# -------------------------------------------------
COPY package*.json ./

# -------------------------------------------------
# Instalar dependencias
# -------------------------------------------------
RUN npm install --production

# -------------------------------------------------
# Copiar el c√≥digo fuente
# -------------------------------------------------
COPY . .

# -------------------------------------------------
# Compilar TypeScript
# -------------------------------------------------
RUN npm run build

# -------------------------------------------------
# Exponer el puerto que usa la app
# -------------------------------------------------
EXPOSE ${PORT}

# -------------------------------------------------
# Comando para ejecutar la app
# -------------------------------------------------
CMD ["node", "dist/index.js"]